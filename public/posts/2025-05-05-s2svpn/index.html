<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Uros hugo site hosten on github pages</title>
<meta name="keywords" content="">
<meta name="description" content="Cisco VPN Site to Site Lab over IPSec


IPsec protocol
IPSec or Internet Protocol security if actually a group of protocols that are formed to set  up a secure Logical medium/line across an unsecure Network.
IPSec procol group is fundemental for todays Enterprise Networks, there are number of great benefits of implementing IPSec.
The 3 fundemental ones are Authetification, Encryption and Hashing.

o	With authetifcation, both parties can prove its identities by using a Authetifcation protcol, I will be using PSK
o	Encryption is one of the main component of IPSec, With Secure Encryption symetric and asymetric algorithms, our data is safe over the public network
o	Hashing is a concept where we can be sure so that our payloads are not modified or altered during transmission, this protects us from MiTM attacks

How IPSec works (from my point of view)
IPSec works with something called IKE, internet key excange and it’s a standard protocol used to create a secure and private link, this WAN link is called a Tunnel">
<meta name="author" content="">
<link rel="canonical" href="http://localhost:1313/posts/2025-05-05-s2svpn/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.6da9a63d25a9608bca2f7f907a030e887a7dd3c3f3918e4cc113129361414bda.css" integrity="sha256-bammPSWpYIvKL3&#43;QegMOiHp908PzkY5MwRMSk2FBS9o=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/2025-05-05-s2svpn/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Uros hugo site hosten on github pages (Alt + H)">Uros hugo site hosten on github pages</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      
    </h1>
    <div class="post-meta">

</div>
  </header> 
  <div class="post-content"><h2 id="cisco-vpn-site-to-site-lab-over-ipsec">Cisco VPN Site to Site Lab over IPSec<a hidden class="anchor" aria-hidden="true" href="#cisco-vpn-site-to-site-lab-over-ipsec">#</a></h2>
<blockquote>
<p><img alt="Network Topology" loading="lazy" src="/images/ipsecBanner.webp"></p></blockquote>
<h2 id="ipsec-protocol">IPsec protocol<a hidden class="anchor" aria-hidden="true" href="#ipsec-protocol">#</a></h2>
<p>IPSec or Internet Protocol security if actually a group of protocols that are formed to set  up a secure Logical medium/line across an unsecure Network.
IPSec procol group is fundemental for todays Enterprise Networks, there are number of great benefits of implementing IPSec.
The 3 fundemental ones are Authetification, Encryption and Hashing.</p>
<ul>
<li>o	With authetifcation, both parties can prove its identities by using a Authetifcation protcol, I will be using PSK</li>
<li>o	Encryption is one of the main component of IPSec, With Secure Encryption symetric and asymetric algorithms, our data is safe over the public network</li>
<li>o	Hashing is a concept where we can be sure so that our payloads are not modified or altered during transmission, this protects us from MiTM attacks</li>
</ul>
<h2 id="how-ipsec-works-from-my-point-of-view">How IPSec works (from my point of view)<a hidden class="anchor" aria-hidden="true" href="#how-ipsec-works-from-my-point-of-view">#</a></h2>
<p>IPSec works with something called IKE, internet key excange and it’s a standard protocol used to create a secure and private link, this WAN link is called a Tunnel</p>
<p>Virtual Tunnel is a logical communication link that traverses thorugh the public network, a VPN tunnel makes it secure cos a combination of symetric and asymetric algorthims are applied to make the tunnel encryped and fully secure.</p>
<p>So here is how It looks this in practise, we have a device in an private network or a LAN, that device has an internet access though a Router, with NAT or PAT that device first stop is the local ISP, from the ISP there is probably some redundancy to that same ISP different site and this is actually WAN connections.
By using the VPN Tunneling we can ensure that our device when it reaches the local Router from there our data is not visable to anyones other than the Router that is the second peer from there it is decrypted, and the host on Site B will get the right payload.</p>
<h2 id="site-to-site-vpn">Site to Site VPN<a hidden class="anchor" aria-hidden="true" href="#site-to-site-vpn">#</a></h2>
<p>Site to Site VPN or S2S, is one of the most common types of VPN&rsquo;s implemented in todays networks.
In S2S VPN tunnels or SA&rsquo;s connect multiple sites or just 2 over a WAN link.
At each site VPN gateway encrypts and encapsulates data to exchange over the SA with sites VPN Gateway
Devices in Site A can talk to devices in Site B
They are typically implemented when a company needs redundancy and not a dedicated line that would cost them, they work over the public internet.</p>
<h2 id="overview-of-our-lab-demostration-and-prepare-phase">Overview of our lab demostration and prepare phase<a hidden class="anchor" aria-hidden="true" href="#overview-of-our-lab-demostration-and-prepare-phase">#</a></h2>
<p>We have 2 sites, Site A and Site B.
Site A just has a VPC and its directly connected to its Router.
Site B also has a VPC and its direclty connected to its Router.
The Routers are directly connected for simplicity and Hardware utilizaton.
Policies need to match on both sites For IKEv1 Phase 1 - Building the SA
ACL needs to be applied correctly on both sites
PSK also needs to be set on set up correclty on 2 peers.</p>
<blockquote>
<p><img alt="IPSecFinalimage" loading="lazy" src="/images/topology-ipsec.png"></p></blockquote>
<h2 id="ipsec-vpn-phase-1-configuration">IPSec VPN Phase 1 configuration<a hidden class="anchor" aria-hidden="true" href="#ipsec-vpn-phase-1-configuration">#</a></h2>
<p>First we will be configuring the Phase 1 of IKEv1, this phase is called the build phase.
It is called that way cos we need to plan the policies for both parties(routers)
So we will agree for both routers to be configured this way :
- Encryption AES 256 (Symetric encryption)
- Hashing SHA 256
- Authetication Pre Shared keys (PSK Secret)
- Diffie Hellman Group Number 5
- Lifetime of the SA is 7000 secons
Once we got the plan lets get to configuring the isakmp (IKE on Cisco IOS)
(One more important thing before configuring is that you need a license on a Cisco router, you need a securityk9-univerisal license. The Cisco CSR1000V has that but utilizes a lot of memory)</p>
<p>IKEv1 Phase 1 config</p>
<pre tabindex="0"><code class="language-cisco" data-lang="cisco">R1(config)#
R1(config)#crypto isakmp policy 5
R1(config-isakmp)#authentication pre-share 
R1(config-isakmp)#hash sha256
R1(config-isakmp)#encryption aes 256
R1(config-isakmp)#group 5
R1(config-isakmp)#lifetime 5000
</code></pre><p>Also not to forget add the ISAKMP key the PSK we enabled,</p>
<pre tabindex="0"><code class="language-cisco" data-lang="cisco">R1(config)#crypto isakmp key UrosCCNA address 0.0.0.0
</code></pre><h2 id="phase-2-of-ipsec-ikev1">Phase 2 of IPSec IKEv1<a hidden class="anchor" aria-hidden="true" href="#phase-2-of-ipsec-ikev1">#</a></h2>
<p>In this phase we will be creating the actual Security Association
Also during the phase 2 will be configuring an extended ACL.
(In that ACL we will permit R1 inside host to reach the second peer)</p>
<pre tabindex="0"><code class="language-cisco" data-lang="cisco">R1(config)# crypto ipsec transform-set Our-SET esp-aes 128 esp-sha384 
R1(cfg-crypto-trans)#mode tunnel
R1(config)#ip access-list extended Crypto-ACL
R1(config-ext-nacl)#permit ip 10.1.0.0 0.0.255.255 10.2.0.0 0.0.255.255
R1(config-ext-nacl)#crypto map Our-MAP 10 ipsec-isakmp 
R1(config-crypto-map)#
R1(config-crypto-map)#match address Cry 
R1(config-crypto-map)#match address Crypto-ACL
R1(config-crypto-map)#set peer 25.2.2.2
R1(config-crypto-map)#set transform-set Our-SET
R1(config-crypto-map)#set pfs group15 
R1(config-crypto-map)#exit
</code></pre><p>Here is an image or an overivew of what we configured for both phases.
(When configuring orginally i made a mistake and set up 2 peers. One in the config is how is valid)</p>
<blockquote>
<p><img alt="CryptoMapSummeryConfig" loading="lazy" src="/images/crypto-map.png"></p></blockquote>
<h2 id="wan-link-configuration">WAN link configuration<a hidden class="anchor" aria-hidden="true" href="#wan-link-configuration">#</a></h2>
<p>Finally we just need to apply the config we typed earlier and we should get a message from ISAKMP</p>
<pre tabindex="0"><code class="language-cisco" data-lang="cisco">R1(config)#int gig0/1
R1(config-if)#cr
R1(config-if)#crypto map Our-MAP
R1(config-if)#
</code></pre>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="http://localhost:1313/">Uros hugo site hosten on github pages</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
